name: CI

on: [push]

jobs:
  std_job:

    runs-on: ubuntu-latest
    container:
      image: docker://chapel/chapel:1.20.0

    steps:
    - uses: actions/checkout@v2
    - name: Comm=none compile
      working-directory: ${GITHUB_WORKSPACE}
      run: |
        apt-get update -qq && apt-get install -qq -y libhdf5-dev libzmq3-dev python3-pip
        echo "\$(eval \$(call add-path,/usr/lib/x86_64-linux-gnu/hdf5/serial/))" > Makefile.paths
        ARKOUDA_DEVELOPER=true make
        python3 --version

  gasnet_job:

    runs-on: ubuntu-latest
    container:
      image: docker://chapel/chapel-gasnet:1.20.0

    steps:
    - uses: actions/checkout@v2
    - name: Comm=gasnet compile
      working-directory: ${GITHUB_WORKSPACE}
      run: |
        apt-get update -qq && apt-get install -qq -y libhdf5-dev libzmq3-dev python3-pip
        echo "\$(eval \$(call add-path,/usr/lib/x86_64-linux-gnu/hdf5/serial/))" > Makefile.paths
        ARKOUDA_DEVELOPER=true make
